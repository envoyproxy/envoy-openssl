resources:
  containers:
  - container: envoy-build-image
    image: envoyproxy/envoy-build:latest

trigger:
  branches:
    include:
    - 'master'

jobs:
  - job: build
    dependsOn: []
    pool:
      vmImage: 'Ubuntu 16.04'
    container: envoy-build-image
    steps:
      - checkout: self
        submodules: true
      - script: |
          bazel build --copt="-Wno-error" //:envoy && \
          ./bazel-bin/envoy --version
        displayName: 'Build Envoy-OpenSSL'
#  - job: test
#    dependsOn: []
#    pool:
#      vmImage: 'Ubuntu 16.04'
#    container: envoy-build-image
#    steps:
#      - checkout: self
#        submodules: true
#      - script: |
#          bazel test //test/common/... && \
#          bazel test //test/extensions/...
#        displayName: 'Test Envoy-OpenSSL'
#  - job: test-envoy
#    dependsOn: []
#    pool:
#      vmImage: 'Ubuntu 16.04'
#    container: envoy-build-image
#    steps:
#      - checkout: self
#        submodules: true
#      - script: bazel test @envoy//test/...
#        displayName: 'Test Envoy'
